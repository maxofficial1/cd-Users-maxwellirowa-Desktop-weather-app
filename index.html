// Function to fetch matching cities using the Geocoding API
async function getCities(city) {
    const apiKey = 'f716f862a52b41808bd514356664bfa3'; // Your OpenWeather API key
    const url = `https://api.openweathermap.org/geo/1.0/direct?q=${city}&limit=5&appid=${apiKey}`;

    try {
        const response = await fetch(url);
        if (!response.ok) {
            throw new Error('City not found. Please enter a valid city name.');
        }
        const cities = await response.json();

        if (cities.length === 0) {
            alert('No matching cities found.');
            return;
        }

        displayCities(cities);
    } catch (error) {
        console.error('Error fetching city data:', error);
        alert('Error: ' + error.message);
    }
}

// Function to display matching cities for user selection
function displayCities(cities) {
    const cityList = document.getElementById('city-list');
    cityList.innerHTML = ''; // Clear previous results

    cities.forEach((city, index) => {
        const listItem = document.createElement('li');
        listItem.innerText = `${city.name}, ${city.state || ''}, ${city.country}`;
        listItem.addEventListener('click', () => getWeather(city.lat, city.lon));
        cityList.appendChild(listItem);
    });
}

// Function to fetch weather data for the selected city
async function getWeather(lat, lon) {
    const apiKey = 'f716f862a52b41808bd514356664bfa3'; // Your OpenWeather API key
    const url = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${apiKey}&units=imperial`;

    try {
        const response = await fetch(url);
        if (!response.ok) {
            throw new Error('Weather data not found.');
        }
        const data = await response.json();
        displayWeather(data);
    } catch (error) {
        console.error('Error fetching weather data:', error);
        alert('Error fetching weather data: ' + error.message);
    }
}

// Function to display weather data
function displayWeather(data) {
    const cityName = document.getElementById('city-name');
    const temperature = document.getElementById('temperature');
    const weatherDescription = document.getElementById('weather-description');

    cityName.innerText = `Weather in ${data.name}`;
    temperature.innerText = `Temperature: ${data.main.temp.toFixed(1)}Â°F`;
    weatherDescription.innerText = `Weather: ${data.weather[0].description.charAt(0).toUpperCase() + data.weather[0].description.slice(1)}`;
}

// Event listener for the Enter key or button click
document.getElementById('get-weather-btn').addEventListener('click', () => {
    const city = document.getElementById('city-input').value.trim();
    if (city) {
        getCities(city);
    } else {
        alert('Please enter a city name.');
    }
});

document.getElementById('city-input').addEventListener('keypress', (event) => {
    if (event.key === 'Enter') {
        const city = document.getElementById('city-input').value.trim();
        if (city) {
            getCities(city);
        }
    }
});